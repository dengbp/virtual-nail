# virtual-nail
SystemåŸºäºAIçš„ç¾ç”²è™šæ‹Ÿè¯•æˆ´ç³»ç»Ÿ - é›†æˆUÂ²-Netåˆ†å‰²ã€åƒç´ çº§é¢œè‰²è¿ç§»ã€ç‰©ç†å…‰ç…§æ¸²æŸ“ã€SDXL AIå¢å¼ºçš„å®Œæ•´ç¾ç”²æ•ˆæœé¢„è§ˆè§£å†³æ–¹æ¡ˆ
# ğŸ¨ AIç¾ç”²è™šæ‹Ÿè¯•æˆ´ç³»ç»Ÿ (Virtual-Nail System)

## ğŸŒŸ æ•ˆæœå±•ç¤º

### ğŸ’… äº§å“å¸¸è§„æ•ˆæœå›¾

<div align="center">
  <table>
    <tr>
      <td align="center">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/2623972fdc1c1567e6cdf25adf7d4fa2.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾1" />
      </td>
      <td align="center">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/3b98f9a6735ee1723574f37be555b2ea.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾2" />
      </td>
      <td align="center">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/473e5b33eadd99338de65d83d59d419f.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾3" />
      </td>
      <td align="center">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/685c7a11bb16e20c3a68f762fab8db9f.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾4" />
      </td>
    </tr>
    <tr>
      <td align="center">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/8ecf1799dd43a49a21296b7b3f435488.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾5" />
      </td>
      <td align="center">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/a566b30aaa08d360f9ff6518682b4d72.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾6" />
      </td>
      <td align="center">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/b07f0a85dda7ac1548ace782d5ea2cbf.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾7" />
      </td>
      <td align="center">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/d302eaf0e5d6202d608eb7e9573e094a.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾8" />
      </td>
    </tr>
    <tr>
      <td align="center" colspan="2">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/e9b1ba1895154a1a9033cd2a4dbe7662.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾9" />
      </td>
      <td align="center" colspan="2">
        <img src="data/äº§å“å¸¸è§„æ•ˆæœå›¾/fc12e78b4e95c1807d585b05e470764b.JPG" width="180" alt="ç¾ç”²æ•ˆæœå›¾10" />
      </td>
    </tr>
  </table>
  <p><em>å±•ç¤ºå¤šç§ç¾ç”²é¢œè‰²å’Œé£æ ¼çš„AIç”Ÿæˆæ•ˆæœï¼Œè‰²å½©é¥±æ»¡ï¼Œè´¨æ„Ÿé€¼çœŸ</em></p>
</div>

### ğŸ¨ å¹¿å‘Šå®£ä¼ æ•ˆæœå›¾

<div align="center">
  <table>
    <tr>
      <td align="center">
        <img src="data/å¹¿å‘Šå®£ä¼ æ•ˆæœå›¾/1e0b3f5a4d76e2a656df918b561e545a.JPG" width="300" alt="å¹¿å‘Šå®£ä¼ å›¾1" />
        <br><em>ä¸“ä¸šçº§ç¾ç”²å±•ç¤ºæ•ˆæœ</em>
      </td>
      <td align="center">
        <img src="data/å¹¿å‘Šå®£ä¼ æ•ˆæœå›¾/IMG_1525.jpg" width="300" alt="å¹¿å‘Šå®£ä¼ å›¾2" />
        <br><em>åˆ›æ„ç¾ç”²è®¾è®¡å±•ç¤º</em>
      </td>
    </tr>
  </table>
  <p><em>é«˜å“è´¨çš„å®£ä¼ å±•ç¤ºå›¾ï¼Œçªå‡ºç¾ç”²è‰ºæœ¯çš„ç²¾è‡´ä¸ç¾æ„Ÿ</em></p>
</div>

### âœ¨ æŠ€æœ¯ç‰¹è‰²

<div align="center">
  <table>
    <tr>
      <td align="center" width="25%">
        <strong>ğŸ¯ ç²¾å‡†åˆ†å‰²</strong>
        <br>UÂ²-Netæ·±åº¦å­¦ä¹ <br>IoU > 0.92
      </td>
      <td align="center" width="25%">
        <strong>ğŸ¨ é¢œè‰²è¿ç§»</strong>
        <br>TPSå˜å½¢ç®—æ³•<br>åƒç´ çº§ç²¾ç¡®
      </td>
      <td align="center" width="25%">
        <strong>ğŸ’¡ ç‰©ç†å…‰ç…§</strong>
        <br>Phongæ¨¡å‹<br>é€¼çœŸé«˜å…‰æ¸²æŸ“
      </td>
      <td align="center" width="25%">
        <strong>ğŸ¤– AIå¢å¼º</strong>
        <br>SDXLæ·±åº¦ä¼˜åŒ–<br>ä¸“ä¸šçº§è´¨æ„Ÿ
      </td>
    </tr>
  </table>
</div>

## ğŸ“– é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºäººå·¥æ™ºèƒ½çš„ç¾ç”²è™šæ‹Ÿè¯•æˆ´ç³»ç»Ÿï¼Œé€šè¿‡æ·±åº¦å­¦ä¹ æŠ€æœ¯å®ç°ä»ç®€å•é¢œè‰²æ›¿æ¢åˆ°ä¸“ä¸šçº§ç¾ç”²æ•ˆæœæ¸²æŸ“çš„æŠ€æœ¯çªç ´ã€‚ç³»ç»Ÿé‡‡ç”¨**ä¸‰é˜¶æ®µæ¸è¿›å¼å¤„ç†æ¶æ„**ï¼Œå°†ä¼ ç»Ÿå›¾åƒå¤„ç†ä¸å‰æ²¿AIæŠ€æœ¯å®Œç¾èåˆï¼Œä¸ºç¾ç”²è¡Œä¸šæä¾›äº†é©å‘½æ€§çš„æ•°å­—åŒ–è§£å†³æ–¹æ¡ˆã€‚

### ğŸ¯ æ ¸å¿ƒä»·å€¼

- **ğŸª å•†ä¸šåº”ç”¨**: ç¾ç”²åº—å®¢æˆ·å¯å®æ—¶é¢„è§ˆç¾ç”²æ•ˆæœï¼Œæå‡æœåŠ¡ä½“éªŒ
- **ğŸ›’ ç”µå•†å¢å¼º**: ç¾ç”²äº§å“åœ¨çº¿è¯•æˆ´ï¼Œå¤§å¹…æå‡è½¬åŒ–ç‡
- **ğŸ“± ç§»åŠ¨é›†æˆ**: å¯é›†æˆåˆ°ç¾å¦†APPï¼Œæä¾›ä¸ªäººç¾ç”²é¢„è§ˆåŠŸèƒ½
- **ğŸ¨ åˆ›æ„è®¾è®¡**: ç¾ç”²å¸ˆå¯å¿«é€ŸéªŒè¯è®¾è®¡æ•ˆæœï¼Œä¼˜åŒ–åˆ›ä½œæµç¨‹

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ§  æ™ºèƒ½æŠ€æœ¯æ ˆ
- **æ·±åº¦å­¦ä¹ åˆ†å‰²**: åŸºäºUÂ²-Netçš„é«˜ç²¾åº¦æŒ‡ç”²åŒºåŸŸè¯†åˆ«ï¼ˆIoU > 0.92ï¼‰
- **åƒç´ çº§é¢œè‰²è¿ç§»**: TPSå˜å½¢ç®—æ³•å®ç°ç²¾ç¡®é¢œè‰²ç§»æ¤
- **ç‰©ç†å…‰ç…§æ¸²æŸ“**: Phongæ¨¡å‹ç”Ÿæˆé€¼çœŸé«˜å…‰å’Œé˜´å½±æ•ˆæœ
- **AIè´¨æ„Ÿå¢å¼º**: Stable Diffusion XLæ·±åº¦ä¼˜åŒ–ç»†èŠ‚å’Œè´¨æ„Ÿ
- **æ™ºèƒ½è¾¹ç¼˜èåˆ**: Active Contourç®—æ³•ä¼˜åŒ–åˆ†å‰²è¾¹ç¼˜

### âš¡ å·¥ç¨‹åŒ–ç‰¹æ€§
- **ç”Ÿäº§çº§API**: Flask RESTfulæ¥å£ï¼Œæ”¯æŒé«˜å¹¶å‘éƒ¨ç½²
- **å®æ—¶å¤„ç†**: 30-60ç§’å®Œæˆå®Œæ•´AIå¤„ç†æµç¨‹
- **æ™ºèƒ½ç¼“å­˜**: é¿å…é‡å¤è®¡ç®—ï¼Œå¤§å¹…æå‡æ€§èƒ½
- **å¤šçº§é™çº§**: ç¡®ä¿åœ¨ä»»ä½•ç¯å¢ƒä¸‹éƒ½èƒ½ç¨³å®šè¿è¡Œ
- **å®Œæ•´ç›‘æ§**: è¯¦ç»†æ—¥å¿—å’Œè¿›åº¦å›è°ƒæœºåˆ¶

### ğŸ”§ å¼€å‘å‹å¥½
- **å®Œæ•´å·¥å…·é“¾**: ä»æ•°æ®æ ‡æ³¨åˆ°æ¨¡å‹è®­ç»ƒçš„å…¨æµç¨‹å·¥å…·
- **ä¸°å¯Œæµ‹è¯•**: è¦†ç›–APIã€ç®—æ³•ã€æ€§èƒ½çš„å®Œæ•´æµ‹è¯•ä½“ç³»
- **è¯¦ç»†æ–‡æ¡£**: åŒ…å«APIã€è®­ç»ƒã€éƒ¨ç½²çš„å®Œæ•´æŠ€æœ¯æ–‡æ¡£
- **æ¨¡å—åŒ–è®¾è®¡**: é«˜å†…èšä½è€¦åˆï¼Œä¾¿äºäºŒæ¬¡å¼€å‘

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### ä¸‰é˜¶æ®µå¤„ç†æµæ°´çº¿
<img width="3840" height="3077" alt="ç¾ç”²ç³»ç»Ÿæ¶æ„ _ Mermaid Chart-2025-09-17-061820" src="https://github.com/user-attachments/assets/9f9060b0-f2ad-47a2-bdd4-9818954c5c37" />

### æŠ€æœ¯åˆ›æ–°ç‚¹

1. **åŒé‡æ©ç ç­–ç•¥**: AIç”Ÿæˆä½¿ç”¨æ‰©å¼ æ©ç æä¾›è¶³å¤Ÿç©ºé—´ï¼Œæœ€ç»ˆèåˆä½¿ç”¨ç²¾ç¡®æ©ç ç¡®ä¿è¾¹ç¼˜è‡ªç„¶
2. **ç©ºç™½ç”»å¸ƒæŠ€æœ¯**: é¢„å¡«å……æŒ‡ç”²åŒºåŸŸä¸ºAIæä¾›å¹²å‡€ç”Ÿæˆç”»å¸ƒï¼Œé¿å…åŸè‰²å¹²æ‰°
3. **æ¸è¿›å¼è´¨é‡æå‡**: æ¯é˜¶æ®µä¸“æ³¨ç‰¹å®šæ•ˆæœï¼Œæœ€ç»ˆèåˆè¾¾åˆ°ä¸“ä¸šçº§è´¨é‡
4. **æ™ºèƒ½é™çº§æœºåˆ¶**: Active Contour â†’ å½¢çŠ¶ä¼˜åŒ– â†’ åŸºç¡€å¢å¼º â†’ åŸå§‹æ©ç çš„å››çº§ä¿éšœ

## ğŸ“ é¡¹ç›®ç»“æ„

```
nail-color-preview/
â”œâ”€â”€ ğŸ¯ æ ¸å¿ƒå¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ editor_image_server.py              # ä¸»æœåŠ¡å™¨ - Flask APIæ¥å£
â”‚   â”œâ”€â”€ color_nail_full_pipeline_adapter.py # å®Œæ•´æµæ°´çº¿é€‚é…å™¨
â”‚   â”œâ”€â”€ color_transfer_pixel_level_transplant.py  # ç¬¬ä¸€é˜¶æ®µï¼šåƒç´ è¿ç§»
â”‚   â”œâ”€â”€ color_nail_highlight_fill.py        # ç¬¬äºŒé˜¶æ®µï¼šé«˜å…‰æ¸²æŸ“
â”‚   â”œâ”€â”€ color_transfer_pixel_level_refine_sdxl.py # ç¬¬ä¸‰é˜¶æ®µï¼šAIç²¾ç‚¼
â”‚   â””â”€â”€ nail_color_transfer.py              # é¢œè‰²è¿ç§»æ ¸å¿ƒç®—æ³•
â”‚
â”œâ”€â”€ ğŸ§  AIæ¨¡å‹ç›¸å…³
â”‚   â”œâ”€â”€ u2net_model.py                      # UÂ²-Netæ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ train_u2net_pytorch.py              # UÂ²-Netè®­ç»ƒè„šæœ¬ï¼ˆä¸»åŠ›ï¼‰
â”‚   â”œâ”€â”€ train_u2net_stable.py               # ç¨³å®šç‰ˆè®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ train_u2net_memory_optimized.py     # å†…å­˜ä¼˜åŒ–è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ nail_sdxl_inpaint_opencv.py         # SDXLå¢å¼ºå¤„ç†ç±»
â”‚   â”œâ”€â”€ nail_sdxl_inpaint_purecolor.py      # çº¯è‰²SDXLå¤„ç†
â”‚   â””â”€â”€ nail_active_contour_enhancer.py     # Active Contourå¢å¼º
â”‚
â”œâ”€â”€ ğŸ“Š æ•°æ®å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ convert_labelme_to_masks.py         # LabelMeæ ‡æ³¨è½¬æ¢å™¨
â”‚   â”œâ”€â”€ preprocess_training_data_precise.py # ç²¾ç¡®æ•°æ®é¢„å¤„ç†
â”‚   â”œâ”€â”€ validate_labelme_data.py            # æ ‡æ³¨æ•°æ®éªŒè¯
â”‚   â”œâ”€â”€ quick_start_labelme.py              # å¿«é€Ÿæ ‡æ³¨å·¥å…·
â”‚   â””â”€â”€ generate_initial_masks.py           # åˆå§‹æ©ç ç”Ÿæˆ
â”‚
â”œâ”€â”€ ğŸ§ª æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ test_progress_api.py                # APIæ¥å£æµ‹è¯•
â”‚   â”œâ”€â”€ test_api_data_url.py                # APIæ ¼å¼éªŒè¯
â”‚   â”œâ”€â”€ test_color_transfer_pixel_level_pipeline.py # å®Œæ•´æµæ°´çº¿æµ‹è¯•
â”‚   â”œâ”€â”€ test_antialiased_highlight.py       # é«˜å…‰æ¸²æŸ“æµ‹è¯•
â”‚   â”œâ”€â”€ test_nail_sdxl_inpaint_opencv.py    # SDXL AIæµ‹è¯•
â”‚   â”œâ”€â”€ test_highlight_detection.py         # é«˜å…‰æ£€æµ‹æµ‹è¯•
â”‚   â””â”€â”€ test_gray_mask_pipeline.py          # ç°åº¦æ©ç æµ‹è¯•
â”‚
â”œâ”€â”€ ğŸ¨ é«˜çº§æ¸²æŸ“æ¨¡å—
â”‚   â”œâ”€â”€ physical_lighting_system.py         # ç‰©ç†å…‰ç…§ç³»ç»Ÿ
â”‚   â”œâ”€â”€ color_nail_highlight_shader.py      # é«˜å…‰ç€è‰²å™¨
â”‚   â”œâ”€â”€ color_antialiased_highlight_visualizer.py # æŠ—é”¯é½¿å¯è§†åŒ–
â”‚   â””â”€â”€ nail_template_system.py             # æŒ‡ç”²æ¨¡æ¿ç³»ç»Ÿ
â”‚
â”œâ”€â”€ ğŸ”§ å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ download_models.py                  # æ¨¡å‹ä¸‹è½½å·¥å…·
â”‚   â”œâ”€â”€ system_info.py                      # ç³»ç»Ÿä¿¡æ¯æ£€æŸ¥
â”‚   â”œâ”€â”€ fix_encoding_issues.py              # ç¼–ç é—®é¢˜ä¿®å¤
â”‚   â””â”€â”€ security_middleware.py              # å®‰å…¨ä¸­é—´ä»¶
â”‚
â”œâ”€â”€ ğŸ“š æ–‡æ¡£
â”‚   â”œâ”€â”€ API_FLOW_DOCUMENTATION.md           # APIæµç¨‹æ–‡æ¡£
â”‚   â”œâ”€â”€ TESTING_GUIDE.md                    # æµ‹è¯•æŒ‡å—
â”‚   â”œâ”€â”€ è®­ç»ƒç¯å¢ƒå®‰è£…æŒ‡å—.md                   # è®­ç»ƒç¯å¢ƒæŒ‡å—
â”‚   â”œâ”€â”€ MID_TERM_UPGRADE.md                 # ä¸­æœŸå‡çº§è¯´æ˜
â”‚   â””â”€â”€ memory_bank.md                      # æŠ€æœ¯çŸ¥è¯†åº“
â”‚
â””â”€â”€ ğŸ“¦ é…ç½®æ–‡ä»¶
    â”œâ”€â”€ requirements.txt                     # Pythonä¾èµ–
    â”œâ”€â”€ config.py                           # ç³»ç»Ÿé…ç½®
    â””â”€â”€ logging_config.py                   # æ—¥å¿—é…ç½®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

#### ç¡¬ä»¶è¦æ±‚
- **GPU**: NVIDIA RTX 2080+ (8GB+ VRAM) æ¨èRTX A5000 (24+GB)
- **å†…å­˜**: 16GB+ RAMï¼Œè®­ç»ƒæ—¶å»ºè®®32GB+
- **å­˜å‚¨**: 50GB+ å¯ç”¨ç©ºé—´ï¼ˆåŒ…å«æ¨¡å‹æ–‡ä»¶ï¼‰
- **CPU**: Intel i7+ æˆ– AMD Ryzen 7+

#### è½¯ä»¶ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 18.04+ / macOS 10.15+ / Windows 10+
- **Python**: 3.8+ (æ¨è3.9)
- **CUDA**: 11.7+ (å¦‚ä½¿ç”¨GPU)
- **Git**: 2.20+

### å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/dengbp/virtual-nai.git
cd virtual-nai
```

#### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
# ä½¿ç”¨condaï¼ˆæ¨èï¼‰
conda create -n nail-nai python=3.9
conda activate nail-nai

# æˆ–ä½¿ç”¨venv
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate    # Windows
```

#### 3. å®‰è£…ä¾èµ–
```bash
# å®‰è£…PyTorchï¼ˆCUDAç‰ˆæœ¬ï¼‰
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt
```

#### 4. ä¸‹è½½æ¨¡å‹æ–‡ä»¶
```bash
# ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹
python download_models.py

# éªŒè¯æ¨¡å‹å®Œæ•´æ€§
python system_info.py
```

#### 5. åˆ›å»ºæ•°æ®ç›®å½•
```bash
mkdir -p data/{test_images,test_masks,reference,output/final,output/debug}
```

### å¿«é€Ÿæµ‹è¯•

#### å¯åŠ¨APIæœåŠ¡
```bash
# å¯åŠ¨ç¾ç”²ç”ŸæˆæœåŠ¡å™¨
python editor_image_server.py

# æœåŠ¡å™¨å°†åœ¨ http://0.0.0.0:80 å¯åŠ¨
```

#### è¿è¡ŒAPIæµ‹è¯•
```bash
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•
python test_progress_api.py
python test_api_data_url.py
```

#### æµ‹è¯•å®Œæ•´æµæ°´çº¿
```bash
# æµ‹è¯•ä¸‰é˜¶æ®µå¤„ç†æµç¨‹
python test_color_transfer_pixel_level_pipeline.py

# æµ‹è¯•é«˜å…‰æ¸²æŸ“
python test_antialiased_highlight.py

# æµ‹è¯•AIå¢å¼º
python test_nail_sdxl_inpaint_opencv.py
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. æ™ºèƒ½æŒ‡ç”²åˆ†å‰²

#### UÂ²-Netæ·±åº¦å­¦ä¹ æ¨¡å‹
- **æ¨¡å‹æ¶æ„**: U-shaped 2D Network with 7-layer deep supervision
- **è®­ç»ƒæ•°æ®**: 1606å¼ é«˜è´¨é‡æ‰‹éƒ¨å›¾åƒ + ç²¾ç¡®æ ‡æ³¨
- **åˆ†å‰²ç²¾åº¦**: IoU > 0.92, Dice > 0.95
- **è¾¹ç¼˜ä¼˜åŒ–**: Active Contourç®—æ³•è¿›ä¸€æ­¥ç²¾åŒ–è¾¹ç¼˜

#### å…³é”®è®­ç»ƒæ–‡ä»¶
```python
# æ¨¡å‹å®šä¹‰
u2net_model.py              # UÂ²-Netç½‘ç»œæ¶æ„

# è®­ç»ƒè„šæœ¬
train_u2net_pytorch.py      # ä¸»è®­ç»ƒè„šæœ¬ï¼ˆè¶…é«˜é²æ£’æ€§ï¼‰
train_u2net_stable.py       # ç¨³å®šç‰ˆï¼ˆé€‚åˆè°ƒè¯•ï¼‰
train_u2net_memory_optimized.py  # å†…å­˜ä¼˜åŒ–ç‰ˆ

# æ•°æ®é¢„å¤„ç†
preprocess_training_data_precise.py  # ç²¾ç¡®é¢„å¤„ç†ï¼ˆ1024é•¿è¾¹ï¼‰
convert_labelme_to_masks.py          # LabelMeæ ‡æ³¨è½¬æ¢
validate_labelme_data.py             # æ ‡æ³¨æ•°æ®éªŒè¯
```

### 2. åƒç´ çº§é¢œè‰²è¿ç§»

#### TPSå˜å½¢ç®—æ³•
- **æŠ€æœ¯åŸç†**: Thin Plate Splineéåˆšæ€§å˜å½¢
- **å…³é”®ç‚¹æ£€æµ‹**: åŸºäºæ©ç è½®å»“çš„æ™ºèƒ½å…³é”®ç‚¹æå–
- **æ— ç¼èåˆ**: Alphaæ··åˆ + è¾¹ç¼˜ç¾½åŒ–

#### æ ¸å¿ƒæ¨¡å—æ–‡ä»¶
```python
# ä¸»å¤„ç†æ¨¡å—
color_transfer_pixel_level_transplant.py

# é¢œè‰²è¿ç§»æ ¸å¿ƒ
nail_color_transfer.py

# å®Œæ•´æµæ°´çº¿é€‚é…å™¨
color_nail_full_pipeline_adapter.py
```

### 3. ç‰©ç†å…‰ç…§æ¸²æŸ“

#### Phongå…‰ç…§æ¨¡å‹
- **ç¯å¢ƒå…‰**: 0.3å¼ºåº¦åŸºç¡€ç…§æ˜
- **æ¼«åå°„**: 0.7å¼ºåº¦è¡¨é¢æ•£å°„
- **é•œé¢åå°„**: å¯è°ƒå¼ºåº¦é«˜å…‰æ•ˆæœ
- **æŠ—é”¯é½¿**: å¤šå€é‡‡æ ·æ¶ˆé™¤è¾¹ç¼˜é”¯é½¿

#### é«˜å…‰æ¸²æŸ“æ¨¡å—æ–‡ä»¶
```python
# ç‰©ç†å…‰ç…§ç³»ç»Ÿ
physical_lighting_system.py

# é«˜å…‰æ¸²æŸ“
color_nail_highlight_fill.py

# é«˜å…‰ç€è‰²å™¨
color_nail_highlight_shader.py

# æŠ—é”¯é½¿å¯è§†åŒ–
color_antialiased_highlight_visualizer.py
```

### 4. SDXL AIå¢å¼º

#### Stable Diffusion XLé›†æˆ
- **æ¨¡å‹**: stabilityai/stable-diffusion-xl-base-1.0
- **ControlNet**: ç»“æ„æ§åˆ¶å’Œè¾¹ç¼˜ä¿æŒ
- **IP-Adapter**: é£æ ¼å‚è€ƒå’Œè´¨æ„Ÿè¿ç§»
- **ä¼˜åŒ–ç­–ç•¥**: æ··åˆç²¾åº¦ + æ¢¯åº¦æ£€æŸ¥ç‚¹

#### æ ¸å¿ƒæ¨¡å—æ–‡ä»¶
```python
# SDXLå¤„ç†ç±»
nail_sdxl_inpaint_opencv.py

# AIç²¾ç‚¼ç®¡é“
color_transfer_pixel_level_refine_sdxl.py

# çº¯è‰²å¤„ç†ç‰ˆæœ¬
nail_sdxl_inpaint_purecolor.py
```

## ğŸ§ª æµ‹è¯•æ–‡ä»¶æ˜ å°„è¡¨

| æµ‹è¯•ç±»å‹ | æµ‹è¯•è„šæœ¬ | å¯¹åº”æ ¸å¿ƒæ¨¡å— | åŠŸèƒ½æè¿° | ä¼˜å…ˆçº§ |
|---------|---------|-------------|---------|--------|
| **ğŸŒ APIæ¥å£æµ‹è¯•** |
| APIå®Œæ•´è°ƒç”¨ | `test_progress_api.py` | `editor_image_server.py` | å®Œæ•´APIè°ƒç”¨æµç¨‹ï¼ŒåŒ…å«ä»»åŠ¡æäº¤ã€è¿›åº¦æŸ¥è¯¢ã€ç»“æœè·å– | â­â­â­â­â­ |
| APIæ ¼å¼éªŒè¯ | `test_api_data_url.py` | `editor_image_server.py` | Data URLæ ¼å¼éªŒè¯ï¼Œbase64ç¼–è§£ç æµ‹è¯• | â­â­â­â­ |
| å‚è€ƒå›¾API | `test_reference_only_api.py` | `editor_image_server.py` | Reference-onlyæ¨¡å¼APIæµ‹è¯• | â­â­â­ |
| **ğŸ¨ ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€é¢œè‰²è¿ç§»** |
| å®Œæ•´æµæ°´çº¿ | `test_color_transfer_pixel_level_pipeline.py` | `color_transfer_pixel_level_transplant.py` | åƒç´ çº§é¢œè‰²è¿ç§» + TPSå˜å½¢ + æ— ç¼èåˆ | â­â­â­â­â­ |
| é¢œè‰²è¿ç§»è´¨é‡ | `test_color_transfer.py` | `nail_color_transfer.py` | é¢œè‰²å‡†ç¡®æ€§è¯„ä¼°ï¼Œè¾¹ç¼˜èåˆè´¨é‡æµ‹è¯• | â­â­â­â­ |
| ç°åº¦æ©ç å¤„ç† | `test_gray_mask_pipeline.py` | `color_transfer_pixel_level_transplant.py` | ç°åº¦æ©ç å¤„ç†å’Œé¢œè‰²å‡†ç¡®æ€§éªŒè¯ | â­â­â­ |
| **âœ¨ ç¬¬äºŒé˜¶æ®µï¼šç‰©ç†å…‰ç…§æ¸²æŸ“** |
| æŠ—é”¯é½¿é«˜å…‰ | `test_antialiased_highlight.py` | `color_nail_highlight_fill.py` | æŠ—é”¯é½¿é«˜å…‰ç¢ç‰‡å¤„ç†ï¼Œå¯è§†åŒ–å¯¹æ¯” | â­â­â­â­â­ |
| é«˜å…‰æ£€æµ‹ | `test_highlight_detection.py` | `color_nail_highlight_shader.py` | è‡ªé€‚åº”é«˜å…‰æ£€æµ‹ï¼Œå…‰ç…§å‚æ•°ä¼˜åŒ– | â­â­â­â­ |
| çº¯é«˜å…‰æ¸²æŸ“ | `test_run_highlight_only.py` | `color_nail_highlight_fill.py` | ç‹¬ç«‹é«˜å…‰æ¸²æŸ“æ¨¡å—æµ‹è¯• | â­â­â­ |
| **ğŸ¤– ç¬¬ä¸‰é˜¶æ®µï¼šAIæ·±åº¦ä¼˜åŒ–** |
| SDXLå¢å¼º | `test_nail_sdxl_inpaint_opencv.py` | `nail_sdxl_inpaint_opencv.py` | SDXL Inpainting + IP-Adapter + ControlNet | â­â­â­â­â­ |
| AIå‚æ•°ä¼˜åŒ– | `test_inference_steps.py` | `nail_sdxl_inpaint_purecolor.py` | æ¨ç†æ­¥æ•°å’Œå‚æ•°ä¼˜åŒ–æµ‹è¯• | â­â­â­ |
| è¿›åº¦å›è°ƒ | `test_progress_callback.py` | `nail_sdxl_inpaint_purecolor.py` | AIç”Ÿæˆè¿›åº¦ç›‘æ§å’Œå›è°ƒæµ‹è¯• | â­â­ |
| **ğŸ”„ ç»¼åˆé›†æˆæµ‹è¯•** |
| ä¸»æµæ°´çº¿ | `test_main_pipeline_no_template.py` | `color_nail_full_pipeline_adapter.py` | æ— æ¨¡æ¿å®Œæ•´æµæ°´çº¿æµ‹è¯• | â­â­â­â­ |
| ä»»åŠ¡IDéªŒè¯ | `test_task_id.py` | `editor_image_server.py` | ä»»åŠ¡IDç”Ÿæˆå’Œè¿½è¸ªæµ‹è¯• | â­â­ |
| å¤§æ–‡ä»¶ä¸Šä¼  | `test_large_file_upload.py` | `editor_image_server.py` | å¤§å›¾åƒæ–‡ä»¶ä¸Šä¼ æ€§èƒ½æµ‹è¯• | â­â­ |

## ğŸ“Š è®­ç»ƒæ•°æ®æµå‘å›¾

<img width="914" height="3839" alt="ç¾ç”²è®­ç»ƒæ•°æ®æµå‘å›¾ _ Mermaid Chart-2025-09-17-062349" src="https://github.com/user-attachments/assets/c9579c02-2274-492c-8396-c6f58184c261" />


## ğŸ”„ æ•°æ®é¢„å¤„ç†æµç¨‹å›¾

<img width="2751" height="3840" alt="ç¾ç”²æ•°æ®é¢„å¤„ç†æµç¨‹å›¾ _ Mermaid Chart-2025-09-17-062500" src="https://github.com/user-attachments/assets/5fa0e4f7-4552-457f-9644-35402e4e2748" />


## ğŸ¯ æ ¸å¿ƒå¤„ç†æ•°æ®æµå‘å›¾

<img width="898" height="3840" alt="ç¾ç”²æ ¸å¿ƒå¤„ç†æ•°æ®æµå‘å›¾ _ Mermaid Chart-2025-09-17-062628" src="https://github.com/user-attachments/assets/985f68dc-676a-42a2-b3d9-1e3fe8f620b7" />


## ğŸ”§ æŠ€æœ¯æ ˆè¯¦è§£

### æ·±åº¦å­¦ä¹ æ¡†æ¶
- **torch>=2.0.0+cu121** - PyTorch CUDAç‰ˆæœ¬
- **torchvision>=0.15.0** - è®¡ç®—æœºè§†è§‰åº“
- **diffusers>=0.21.0** - Stable Diffusionç®¡é“
- **transformers>=4.25.0** - Transformeræ¨¡å‹
- **controlnet-aux>=0.0.6** - ControlNetè¾…åŠ©å·¥å…·

### å›¾åƒå¤„ç†åº“
- **opencv-python>=4.5.0** - è®¡ç®—æœºè§†è§‰å¤„ç†
- **Pillow>=9.0.0** - å›¾åƒI/Oå’ŒåŸºç¡€å¤„ç†
- **albumentations>=1.3.0** - æ•°æ®å¢å¼º
- **scikit-image>=0.19.0** - ç§‘å­¦å›¾åƒå¤„ç†
- **matplotlib>=3.5.0** - å¯è§†åŒ–å’Œç»˜å›¾

### WebæœåŠ¡æ¡†æ¶
- **Flask>=2.0.0** - WebæœåŠ¡æ¡†æ¶
- **Flask-CORS>=3.0.0** - è·¨åŸŸèµ„æºå…±äº«
- **requests>=2.28.0** - HTTPå®¢æˆ·ç«¯
- **gunicorn>=20.1.0** - WSGIæœåŠ¡å™¨

### æ•°æ®ç§‘å­¦å·¥å…·
- **numpy>=1.21.0** - æ•°å€¼è®¡ç®—
- **scipy>=1.7.0** - ç§‘å­¦è®¡ç®—
- **pandas>=1.3.0** - æ•°æ®å¤„ç†
- **scikit-learn>=1.0.0** - æœºå™¨å­¦ä¹ 
- **tqdm>=4.62.0** - è¿›åº¦æ¡

## ğŸ“Š APIæ¥å£æ–‡æ¡£

### ä¸»è¦æ¥å£

#### POST /edit_nail - ç¾ç”²ç”Ÿæˆæ¥å£

**è¯·æ±‚æ ¼å¼**:
```http
POST /edit_nail HTTP/1.1
Content-Type: application/x-www-form-urlencoded

img=<base64_encoded_image>&ref_img=<base64_encoded_reference>
```

**è¯·æ±‚å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| img | string | æ˜¯ | åŸå§‹æ‰‹éƒ¨å›¾ç‰‡çš„base64ç¼–ç ï¼ˆä¸å«å‰ç¼€ï¼‰ |
| ref_img | string | æ˜¯ | å‚è€ƒé¢œè‰²å›¾ç‰‡çš„base64ç¼–ç ï¼ˆä¸å«å‰ç¼€ï¼‰ |

**å“åº”æ ¼å¼**:
```json
{
    "statusCode": 200,
    "message": "ç”Ÿæˆå®Œæˆ",
    "task_id": "143022123",
    "data": "data:image/png;base64,iVBORw0KGgoAAAANS..."
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```python
import requests
import base64

# ç¼–ç å›¾åƒ
with open("hand.jpg", "rb") as f:
    img_b64 = base64.b64encode(f.read()).decode("utf-8")

with open("color_ref.jpg", "rb") as f:
    ref_b64 = base64.b64encode(f.read()).decode("utf-8")

# å‘é€è¯·æ±‚
response = requests.post("http://localhost/edit_nail", data={
    "img": img_b64,
    "ref_img": ref_b64
})

result = response.json()
if result["statusCode"] == 200:
    # è§£ç å¹¶ä¿å­˜ç»“æœ
    import re
    image_data = re.sub(r'^data:image/\w+;base64,', '', result["data"])
    with open("result.png", "wb") as f:
        f.write(base64.b64decode(image_data))
```

### æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´**: 30-60ç§’ï¼ˆå®Œæ•´AIå¤„ç†ï¼‰
- **å¹¶å‘æ”¯æŒ**: æ”¯æŒå¤šä»»åŠ¡é˜Ÿåˆ—
- **æ–‡ä»¶å¤§å°**: æ”¯æŒæœ€å¤§100MBå›¾åƒ
- **åˆ†è¾¨ç‡**: æœ€é«˜æ”¯æŒ1536pxé•¿è¾¹

## ğŸ§ª æµ‹è¯•ä½“ç³»

### APIæµ‹è¯•
```bash
# åŸºç¡€APIåŠŸèƒ½æµ‹è¯•
python test_progress_api.py

# Data URLæ ¼å¼éªŒè¯
python test_api_data_url.py

# å¤§æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
python test_large_file_upload.py

# ä»»åŠ¡IDç®¡ç†æµ‹è¯•
python test_task_id.py
```

### ç®—æ³•æ¨¡å—æµ‹è¯•
```bash
# ç¬¬ä¸€é˜¶æ®µï¼šé¢œè‰²è¿ç§»æµ‹è¯•
python test_color_transfer_pixel_level_pipeline.py
python test_color_transfer.py

# ç¬¬äºŒé˜¶æ®µï¼šé«˜å…‰æ¸²æŸ“æµ‹è¯•
python test_antialiased_highlight.py
python test_highlight_detection.py
python test_run_highlight_only.py

# ç¬¬ä¸‰é˜¶æ®µï¼šAIå¢å¼ºæµ‹è¯•
python test_nail_sdxl_inpaint_opencv.py
python test_inference_steps.py
python test_progress_callback.py
```

### é›†æˆæµ‹è¯•
```bash
# å®Œæ•´æµæ°´çº¿æµ‹è¯•
python test_main_pipeline_no_template.py

# ç°åº¦æ©ç å¤„ç†æµ‹è¯•
python test_gray_mask_pipeline.py

# è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶
./run_all_tests.sh
```

### è´¨é‡è¯„ä¼°æ ‡å‡†

| æµ‹è¯•ç±»å‹ | è¯„ä¼°æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|---------|---------|--------|
| **APIæ€§èƒ½** | å“åº”æ—¶é—´ | < 60ç§’ |
| **APIç¨³å®šæ€§** | æˆåŠŸç‡ | > 95% |
| **åˆ†å‰²ç²¾åº¦** | IoU | > 0.92 |
| **é¢œè‰²å‡†ç¡®æ€§** | è‰²å·® | < 5% |
| **è¾¹ç¼˜è´¨é‡** | å¹³æ»‘åº¦ | æ— æ˜æ˜¾é”¯é½¿ |
| **AIç”Ÿæˆ** | è´¨æ„ŸçœŸå®åº¦ | äººå·¥è¯„ä¼°8/10 |

## ğŸ“ è®­ç»ƒæŒ‡å—

### æ•°æ®å‡†å¤‡

#### 1. å›¾åƒé‡‡é›†
```bash
# æ¨èå›¾åƒè§„æ ¼
åˆ†è¾¨ç‡: 1024px-4096px
æ ¼å¼: JPG/PNG
è´¨é‡: æ— å‹ç¼©æˆ–è½»åº¦å‹ç¼©
å…‰ç…§: å‡åŒ€å…‰ç…§ï¼Œé¿å…å¼ºé˜´å½±
è§’åº¦: å¤šè§’åº¦æ‰‹éƒ¨å§¿æ€
```

#### 2. æ•°æ®æ ‡æ³¨
```bash
# ä½¿ç”¨LabelMeè¿›è¡Œæ ‡æ³¨
pip install labelme

# å¯åŠ¨æ ‡æ³¨å·¥å…·
labelme

# æ ‡æ³¨å®Œæˆåè½¬æ¢ä¸ºè®­ç»ƒæ ¼å¼
python convert_labelme_to_masks.py
```

#### 3. æ•°æ®é¢„å¤„ç†
```bash
# ç²¾ç¡®é¢„å¤„ç†ï¼ˆæ¨èï¼‰
python preprocess_training_data_precise.py

# éªŒè¯æ•°æ®è´¨é‡
python validate_labelme_data.py
```

### æ¨¡å‹è®­ç»ƒ

#### UÂ²-Netåˆ†å‰²æ¨¡å‹è®­ç»ƒ
```bash
# 1. å‡†å¤‡è®­ç»ƒæ•°æ®
# ç¡®ä¿ data/training_precise/ ç›®å½•åŒ…å«ï¼š
# - images/: 1606å¼ é¢„å¤„ç†å›¾åƒ
# - masks/: å¯¹åº”çš„æ©ç æ–‡ä»¶

# 2. å¼€å§‹è®­ç»ƒï¼ˆä¸»åŠ›è„šæœ¬ï¼‰
python train_u2net_pytorch.py

# è®­ç»ƒé…ç½®
EPOCHS = 120
BATCH_SIZE = 4
LEARNING_RATE = 1e-4
IMAGE_SIZE = 1024  # é•¿è¾¹å°ºå¯¸
```

#### è®­ç»ƒå‚æ•°è°ƒä¼˜
```python
# train_u2net_pytorch.py å…³é”®å‚æ•°
class UltraRobustNailSegmentationDataset:
    def __init__(self, max_size=1024, is_train=True):
        self.max_size = max_size  # 1024é•¿è¾¹
        
        # æ•°æ®å¢å¼ºç­–ç•¥
        self.transform = A.Compose([
            A.LongestMaxSize(max_size=1024),
            A.RandomRotate90(p=0.5),
            A.HorizontalFlip(p=0.5),
            A.ShiftScaleRotate(p=0.7),
            # ... æ›´å¤šå¢å¼º
        ])
```

#### è®­ç»ƒç›‘æ§
```bash
# æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
tail -f train_u2net_detailed.log

# TensorBoardç›‘æ§
tensorboard --logdir runs/training_logs/

# è®­ç»ƒæ›²çº¿å¯è§†åŒ–
python plot_loss_curve.py
```

### æ¨¡å‹è¯„ä¼°
```bash
# ç”ŸæˆéªŒè¯æ©ç 
python generate_initial_masks.py

# è´¨é‡éªŒè¯
python verify_mask_quality.py

# æ€§èƒ½æµ‹è¯•
python test_model_load.py
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### æœ¬åœ°éƒ¨ç½²

#### å¼€å‘ç¯å¢ƒ
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python editor_image_server.py

# é…ç½®æ–‡ä»¶
config.py:
    DEBUG = True
    PORT = 80
    MAX_CONTENT_LENGTH = 100 * 1024 * 1024
```

#### ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨Gunicornéƒ¨ç½²
pip install gunicorn

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
gunicorn -w 4 -b 0.0.0.0:80 --timeout 300 editor_image_server:app

# é…ç½®æ–‡ä»¶
config.py:
    DEBUG = False
    PORT = 80
    WORKERS = 4
```

### Dockeréƒ¨ç½²

#### Dockerfile
```dockerfile
FROM pytorch/pytorch:2.0.1-cuda11.7-cudnn8-runtime

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    libgl1-mesa-glx \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    libgomp1

# å®‰è£…Pythonä¾èµ–
COPY requirements.txt .
RUN pip install -r requirements.txt

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# ä¸‹è½½æ¨¡å‹
RUN python download_models.py

# æš´éœ²ç«¯å£
EXPOSE 80

# å¯åŠ¨å‘½ä»¤
CMD ["python", "editor_image_server.py"]
```

#### æ„å»ºå’Œè¿è¡Œ
```bash
# æ„å»ºé•œåƒ
docker build -t nail-color-preview .

# è¿è¡Œå®¹å™¨
docker run -d \
    --name nail-preview \
    --gpus all \
    -p 80:80 \
    -v $(pwd)/data:/app/data \
    nail-color-preview
```

### äº‘å¹³å°éƒ¨ç½²

#### AWSéƒ¨ç½²
```bash
# EC2å®ä¾‹è¦æ±‚
å®ä¾‹ç±»å‹: g4dn.xlarge (4 vCPU, 16GB RAM, 1x NVIDIA T4)
å­˜å‚¨: 100GB EBS gp3
ç½‘ç»œ: å…¬ç½‘IP + å®‰å…¨ç»„é…ç½®

# ECSéƒ¨ç½²
aws ecs create-cluster --cluster-name nail-preview-cluster
aws ecs register-task-definition --cli-input-json file://task-definition.json
```

#### é˜¿é‡Œäº‘éƒ¨ç½²
```bash
# ECS GPUå®ä¾‹
å®ä¾‹è§„æ ¼: ecs.gn6i-c4g1.xlarge
GPU: NVIDIA T4 (16GB)
é•œåƒ: Ubuntu 20.04 + CUDA 11.7
```

### æ€§èƒ½ä¼˜åŒ–

#### GPUä¼˜åŒ–
```python
# å¯ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
from torch.cuda.amp import autocast, GradScaler

scaler = GradScaler()

with autocast():
    output = model(input)
    loss = criterion(output, target)

scaler.scale(loss).backward()
scaler.step(optimizer)
```

#### å†…å­˜ä¼˜åŒ–
```python
# æ¨¡å‹æ£€æŸ¥ç‚¹
torch.utils.checkpoint.checkpoint(function, *args)

# å†…å­˜æ¸…ç†
import gc
import torch

def cleanup_memory():
    gc.collect()
    torch.cuda.empty_cache()
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. GPUå†…å­˜ä¸è¶³
```bash
# ç—‡çŠ¶ï¼šCUDA out of memory
# è§£å†³æ–¹æ¡ˆï¼š
1. å‡å°batch_size
2. å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹
3. ä½¿ç”¨CPUæ¨ç†

# æ£€æŸ¥GPUçŠ¶æ€
nvidia-smi

# è°ƒæ•´é…ç½®
BATCH_SIZE = 2  # ä»4å‡å°‘åˆ°2
```

#### 2. æ¨¡å‹åŠ è½½å¤±è´¥
```bash
# ç—‡çŠ¶ï¼šæ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨
# è§£å†³æ–¹æ¡ˆï¼š
python download_models.py

# æ‰‹åŠ¨ä¸‹è½½
wget https://example.com/models/u2net.pth -O models/u2net.pth
```

#### 3. APIå“åº”è¶…æ—¶
```bash
# ç—‡çŠ¶ï¼šè¯·æ±‚è¶…æ—¶
# è§£å†³æ–¹æ¡ˆï¼š
1. å¢åŠ è¶…æ—¶æ—¶é—´
2. æ£€æŸ¥GPUå¯ç”¨æ€§
3. ä¼˜åŒ–å›¾åƒåˆ†è¾¨ç‡

# é…ç½®è°ƒæ•´
TIMEOUT = 300  # 5åˆ†é’Ÿè¶…æ—¶
```

#### 4. ä¾èµ–ç‰ˆæœ¬å†²çª
```bash
# ç—‡çŠ¶ï¼šImportErroræˆ–VersionError
# è§£å†³æ–¹æ¡ˆï¼š
1. åˆ›å»ºæ–°è™šæ‹Ÿç¯å¢ƒ
2. æŒ‰é¡ºåºå®‰è£…ä¾èµ–

# æ¸…ç†ç¯å¢ƒ
conda deactivate
conda env remove -n nail-preview
conda create -n nail-preview python=3.9
```

### è°ƒè¯•å·¥å…·

#### æ—¥å¿—åˆ†æ
```python
# å¯ç”¨è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

# æŸ¥çœ‹å¤„ç†æ­¥éª¤
tail -f app.log
tail -f train_u2net_detailed.log
```

#### æ€§èƒ½åˆ†æ
```python
# å¤„ç†æ—¶é—´ç›‘æ§
import time

start_time = time.time()
result = process_image(img)
print(f"å¤„ç†è€—æ—¶: {time.time() - start_time:.2f}ç§’")

# GPUç›‘æ§
watch -n 1 nvidia-smi
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘è§„èŒƒ

#### ä»£ç é£æ ¼
```python
# ä½¿ç”¨Blackä»£ç æ ¼å¼åŒ–
pip install black
black . --line-length 88

# ä½¿ç”¨flake8ä»£ç æ£€æŸ¥
pip install flake8
flake8 . --max-line-length 88

# ç±»å‹æç¤º
from typing import Optional, List, Tuple
def process_image(img: np.ndarray) -> Optional[np.ndarray]:
    pass
```

#### æäº¤è§„èŒƒ
```bash
# æäº¤ä¿¡æ¯æ ¼å¼
<type>(<scope>): <description>

# ç¤ºä¾‹
feat(api): æ·»åŠ è¿›åº¦æŸ¥è¯¢æ¥å£
fix(training): ä¿®å¤U2Netè®­ç»ƒå†…å­˜æ³„æ¼
docs(readme): æ›´æ–°å®‰è£…æŒ‡å—
test(highlight): æ·»åŠ é«˜å…‰æ¸²æŸ“æµ‹è¯•
```

### è´¡çŒ®æµç¨‹

1. **Forké¡¹ç›®** â†’ 2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯** â†’ 3. **å¼€å‘åŠŸèƒ½** â†’ 4. **ç¼–å†™æµ‹è¯•** â†’ 5. **æäº¤PR**

```bash
# 1. Forkåå…‹éš†
git clone https://github.com/your-username/nail-color-preview.git

# 2. åˆ›å»ºåˆ†æ”¯
git checkout -b feature/new-highlight-algorithm

# 3. å¼€å‘å¹¶æµ‹è¯•
# ... å¼€å‘ä»£ç  ...
python test_new_feature.py

# 4. æäº¤æ›´æ”¹
git add .
git commit -m "feat(highlight): å®ç°æ–°çš„é«˜å…‰ç®—æ³•"

# 5. æ¨é€å¹¶åˆ›å»ºPR
git push origin feature/new-highlight-algorithm
```

### å¼€å‘ç¯å¢ƒè®¾ç½®

#### VSCodeé…ç½®
```json
// .vscode/settings.json
{
    "python.defaultInterpreterPath": "./venv/bin/python",
    "python.formatting.provider": "black",
    "python.linting.enabled": true,
    "python.linting.flake8Enabled": true,
    "python.testing.pytestEnabled": true
}
```

#### é¢„æäº¤é’©å­
```bash
# å®‰è£…pre-commit
pip install pre-commit

# é…ç½®é’©å­
cat > .pre-commit-config.yaml << EOF
repos:
  - repo: https://github.com/psf/black
    rev: 22.3.0
    hooks:
      - id: black
  - repo: https://github.com/pycqa/flake8
    rev: 4.0.1
    hooks:
      - id: flake8
EOF

# å®‰è£…é’©å­
pre-commit install
```

## ğŸ“Š æ€§èƒ½åŸºå‡†

### ç¡¬ä»¶é…ç½®å¯¹æ¯”

| é…ç½® | GPU | å¤„ç†æ—¶é—´ | å†…å­˜ä½¿ç”¨ | æ¨èåœºæ™¯ |
|------|-----|---------|---------|----------|
| **å…¥é—¨çº§** | GTX 1660 (6GB) | 90-120ç§’ | 12GB RAM | å¼€å‘æµ‹è¯• |
| **æ ‡å‡†çº§** | RTX 3080 (10GB) | 45-60ç§’ | 16GB RAM | å°è§„æ¨¡ç”Ÿäº§ |
| **ä¸“ä¸šçº§** | RTX A5000 (24GB) | 30-45ç§’ | 32GB RAM | å¤§è§„æ¨¡ç”Ÿäº§ |
| **ä¼ä¸šçº§** | RTX A6000 (48GB) | 20-30ç§’ | 64GB RAM | é«˜å¹¶å‘æœåŠ¡ |

### å¤„ç†èƒ½åŠ›å¯¹æ¯”

| å¹¶å‘æ•° | ç¡¬ä»¶é…ç½® | å¹³å‡å“åº”æ—¶é—´ | æˆåŠŸç‡ | èµ„æºä½¿ç”¨ç‡ |
|--------|---------|-------------|--------|-----------|
| 1 | RTX 3080 | 45ç§’ | 99.5% | GPU 85% |
| 2 | RTX 3080 | 90ç§’ | 98.0% | GPU 95% |
| 4 | RTX A5000 | 60ç§’ | 99.0% | GPU 90% |
| 8 | RTX A6000 | 45ç§’ | 98.5% | GPU 95% |

## ğŸ“ˆ è·¯çº¿å›¾

### å·²å®ŒæˆåŠŸèƒ½ âœ…
- [x] UÂ²-NetæŒ‡ç”²åˆ†å‰²æ¨¡å‹
- [x] ä¸‰é˜¶æ®µå¤„ç†æµæ°´çº¿
- [x] APIæœåŠ¡æ¥å£
- [x] å®Œæ•´æµ‹è¯•ä½“ç³»
- [x] Active Contourè¾¹ç¼˜ä¼˜åŒ–
- [x] SDXL AIå¢å¼ºé›†æˆ

### æ­£åœ¨å¼€å‘ ğŸ”„
- [ ] å®æ—¶è¿›åº¦æ¨é€ï¼ˆWebSocketï¼‰
- [ ] æ‰¹é‡å¤„ç†æ¥å£
- [ ] ç§»åŠ¨ç«¯SDK
- [ ] æ€§èƒ½ç›‘æ§é¢æ¿

### è®¡åˆ’åŠŸèƒ½ ğŸ“‹
- [ ] 3DæŒ‡ç”²æ¸²æŸ“
- [ ] è§†é¢‘ç¾ç”²å¤„ç†
- [ ] å¤šé£æ ¼æ¨¡å‹æ”¯æŒ
- [ ] è¾¹ç¼˜è®¡ç®—ç‰ˆæœ¬
- [ ] ARé›†æˆæ”¯æŒ

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºåè®®ã€‚

### åè®®è¦ç‚¹
- âœ… å•†ä¸šä½¿ç”¨
- âœ… ä¿®æ”¹å’Œåˆ†å‘
- âœ… ç§äººä½¿ç”¨
- âœ… ä¸“åˆ©ä½¿ç”¨
- âŒ æ— è´£ä»»ä¿è¯
- âŒ æ— æ‹…ä¿

## ğŸ™ è‡´è°¢

### å¼€æºé¡¹ç›®
- [Stable Diffusion](https://github.com/Stability-AI/generative-models) - SDXL AIç”Ÿæˆæ¨¡å‹
- [UÂ²-Net](https://github.com/xuebinqin/U-2-Net) - å›¾åƒåˆ†å‰²ç½‘ç»œ
- [ControlNet](https://github.com/lllyasviel/ControlNet) - ç»“æ„æ§åˆ¶æ¨¡å‹
- [IP-Adapter](https://github.com/tencent-ailab/IP-Adapter) - å›¾åƒæç¤ºé€‚é…å™¨
- [PyTorch](https://pytorch.org) - æ·±åº¦å­¦ä¹ æ¡†æ¶
- [OpenCV](https://opencv.org) - è®¡ç®—æœºè§†è§‰åº“

### ç ”ç©¶å‚è€ƒ
- Qin, X., et al. "UÂ²-Net: Going deeper with nested U-structure for salient object detection"
- Rombach, R., et al. "High-Resolution Image Synthesis with Latent Diffusion Models"
- Zhang, L., et al. "Adding Conditional Control to Text-to-Image Diffusion Models"

### æ•°æ®é›†è´¡çŒ®
æ„Ÿè°¢æ‰€æœ‰ä¸ºè®­ç»ƒæ•°æ®æ ‡æ³¨åšå‡ºè´¡çŒ®çš„å¿—æ„¿è€…ä»¬ï¼

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/dengbp/virtual-nail
- **é—®é¢˜åé¦ˆ**: https://github.com/dengbp/virtual-nail/issues
- **åŠŸèƒ½å»ºè®®**: https://github.com/dengbp/virtual-nail/discussions
- **é‚®ç®±**: dengbangpang@gmail.com

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

![GitHub stars](https://img.shields.io/github/stars/dengbp/virtual-nail)
![GitHub forks](https://img.shields.io/github/forks/dengbp/virtual-nail)
![GitHub issues](https://img.shields.io/github/issues/dengbp/virtual-nail)
![GitHub license](https://img.shields.io/github/license/dengbp/virtual-nail)

---

â­ **å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªStarï¼æ‚¨çš„æ”¯æŒæ˜¯æˆ‘ä»¬æŒç»­æ”¹è¿›çš„åŠ¨åŠ›ã€‚**

ğŸ’¬ **æœ‰é—®é¢˜ï¼Ÿæ¬¢è¿åœ¨Issuesä¸­è®¨è®ºï¼Œæˆ‘ä»¬ä¼šå°½å¿«å›å¤ï¼**

ğŸš€ **æƒ³è¦è´¡çŒ®ä»£ç ï¼ŸæŸ¥çœ‹æˆ‘ä»¬çš„è´¡çŒ®æŒ‡å—ï¼Œä¸€èµ·è®©è¿™ä¸ªé¡¹ç›®å˜å¾—æ›´å¥½ï¼**

---

**æœ€åæ›´æ–°**: 2025å¹´9æœˆ17æ—¥  
**å½“å‰ç‰ˆæœ¬**: v2.0  
**ç»´æŠ¤çŠ¶æ€**: ğŸŸ¢ ç§¯æç»´æŠ¤ä¸­
