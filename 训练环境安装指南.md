# 训练环境安装指南

## 🎯 目标
创建一个独立的训练环境，不影响现有的推理环境。

## 📁 环境结构
```
nail-color-preview/
├── train_env/              # 独立训练环境
├── setup_train_env.bat     # 环境设置脚本
├── start_training.bat      # 训练启动脚本
├── train_u2net_pytorch.py # 训练脚本
└── 其他推理相关文件...
```

## 🚀 安装步骤

### 1. 激活训练环境
```bash
# 激活训练环境
train_env\Scripts\activate

# 验证环境
python -c "import sys; print('Python路径:', sys.executable)"
```

### 2. 安装CUDA版本的PyTorch

#### 方法1：官方源（推荐）
```bash
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
```

#### 方法2：国内镜像源
```bash
pip install torch torchvision torchaudio -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

### 3. 安装其他依赖
```bash
pip install scikit-learn albumentations matplotlib tqdm opencv-python
```

### 4. 验证安装
```bash
python -c "import torch; print('PyTorch版本:', torch.__version__); print('CUDA可用:', torch.cuda.is_available()); print('GPU数量:', torch.cuda.device_count() if torch.cuda.is_available() else 0)"
```

## 🎮 使用方法

### 方法1：使用脚本
```bash
# 设置环境
setup_train_env.bat

# 启动训练
start_training.bat
```

### 方法2：手动操作
```bash
# 1. 激活环境
train_env\Scripts\activate

# 2. 开始训练
python train_u2net_pytorch.py
```

## 📊 预期结果

### 成功安装后应该看到：
```
PyTorch版本: 2.x.x+cu121
CUDA可用: True
GPU数量: 1
```

### 训练配置：
- **GPU**: NVIDIA RTX A5000 (24GB)
- **批次大小**: 4
- **最大尺寸**: 1024
- **数据量**: 1606张图像
- **预期时间**: 8-16小时

## ⚠️ 注意事项

1. **网络问题**: 如果下载超时，可以尝试：
   - 使用VPN
   - 更换镜像源
   - 手动下载whl文件

2. **环境隔离**: 
   - 训练环境完全独立
   - 不会影响推理环境
   - 可以同时运行

3. **GPU使用**:
   - 确保推理和训练不同时使用GPU
   - 可以设置CUDA_VISIBLE_DEVICES控制GPU使用

## 🔧 故障排除

### 问题1：CUDA不可用
```bash
# 检查GPU
nvidia-smi

# 重新安装CUDA版本PyTorch
pip uninstall torch torchvision torchaudio
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
```

### 问题2：依赖包安装失败
```bash
# 升级pip
python -m pip install --upgrade pip

# 使用国内镜像
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ 包名
```

### 问题3：内存不足
```bash
# 减少批次大小
# 修改 train_u2net_pytorch.py 中的 batch_size = 2
```

## 📈 训练监控

训练过程中会生成：
- `train_u2net_detailed.log` - 详细训练日志
- `training_curves.png` - 训练曲线图
- `models/u2net_nail_best.pth` - 最优模型

## 🎉 完成

安装完成后，您就可以在独立环境中进行训练，不会影响现有的推理环境！ 